C51 COMPILER V9.60.0.0   TIME                                                              12/30/2022 17:33:04 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIME
OBJECT MODULE PLACED IN .\Objects\time.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE mycode\time.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -time.lst) OBJECT(.\Objects\time.obj)

line level    source

   1          #include "time.h"
   2          
   3          
   4          bit f_cmp_10ms = 0;
   5          bit f_screen_10ms = 0;
   6          bit f_10us = 0;
   7          
   8          
   9          s16 screen_pwm_duty = 60;
  10          s16 cmp_pwm_duty = 40;
  11          
  12          
  13          /******************************
  14          屏幕背光PWM输出
  15          *******************************/
  16          void screen_pwm_out(void)
  17          {
  18   1              static s16 screen_pwm_cnt = 0;
  19   1              
  20   1              screen_pwm_cnt++;
  21   1              
  22   1              if(screen_pwm_duty == 0)
  23   1              {
  24   2                      screen_pwm_pin = 0;
  25   2              }
  26   1              else if(screen_pwm_duty == SCREEN_PWM_CYCLE)
  27   1              {
  28   2                      screen_pwm_pin = 1;
  29   2              }
  30   1              else
  31   1              {
  32   2                      if(screen_pwm_cnt < screen_pwm_duty)
  33   2                      {
  34   3                              screen_pwm_pin = 1;
  35   3                      }
  36   2                      else if(screen_pwm_cnt < SCREEN_PWM_CYCLE)
  37   2                      {
  38   3                              screen_pwm_pin = 0;
  39   3                      }
  40   2                      else
  41   2                      {
  42   3                              screen_pwm_cnt = 0;     
  43   3                              screen_pwm_pin = 1;
  44   3                      }
  45   2              }
  46   1      }
  47          
  48          /******************************
  49          比较器PWM输出
  50          *******************************/
  51          void cmp_pwm_out(void)
  52          {
  53   1              static s16 cmp_pwm_cnt = 0;
  54   1              
C51 COMPILER V9.60.0.0   TIME                                                              12/30/2022 17:33:04 PAGE 2   

  55   1              cmp_pwm_cnt++;
  56   1              if(cmp_pwm_duty == 0)
  57   1              {
  58   2                      cmp_pwm_pin = 0;
  59   2              }
  60   1              else if(cmp_pwm_duty == CMP_PWM_CYCLE)
  61   1              {
  62   2                      cmp_pwm_pin = 1;
  63   2              }
  64   1              else
  65   1              {
  66   2                      if(cmp_pwm_cnt < cmp_pwm_duty)
  67   2                      {
  68   3                              cmp_pwm_pin = 1;                
  69   3                      }
  70   2                      else if(cmp_pwm_cnt < CMP_PWM_CYCLE)
  71   2                      {
  72   3                              cmp_pwm_pin = 0;                        
  73   3                      }
  74   2                      else
  75   2                      {
  76   3                              cmp_pwm_cnt = 0;
  77   3                              cmp_pwm_pin = 1;
  78   3                      }
  79   2              }       
  80   1      }
  81          
  82          void TM0_Isr() interrupt 1
  83          {
  84   1              cmp_pwm_out();
  85   1              screen_pwm_out();
  86   1              f_10us = 1;
  87   1      }
  88          
  89          void TM1_Isr() interrupt 3
  90          {       
  91   1              f_cmp_10ms = 1; 
  92   1              f_screen_10ms = 1;
  93   1      }
  94          
  95          
  96          /******************************
  97          tim0设置为模式2，8位自动重装模式
  98          用于测试输入PWM
  99          *******************************/
 100          void TIM0_Init(void)
 101          {
 102   1              set_bit(TMOD,1);//10设置为8位自动重装
 103   1              reset_bit(TMOD,0);      
 104   1              TL0 = 0XEC;
 105   1              TH0 = 0XEC;//配置为10us定时     
 106   1              TR0 = 1;        
 107   1              ET0 = 1;
 108   1              EA = 1;
 109   1      }
 110          
 111          /*******************************
 112          tim1设置为模式0,16位自动装载
 113          用于产生PWM
 114          ********************************/
 115          void TIM1_Init(void)
 116          {
C51 COMPILER V9.60.0.0   TIME                                                              12/30/2022 17:33:04 PAGE 3   

 117   1              //reset_bit(TMOD,5);
 118   1              //reset_bit(TMOD,4);    
 119   1              TL1 = 0xE0;//配置为1ms定时
 120   1              TH1 = 0xB1;
 121   1              TR1 = 1;
 122   1              ET1 = 1;
 123   1              EA = 1; 
 124   1      }
 125          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    205    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
